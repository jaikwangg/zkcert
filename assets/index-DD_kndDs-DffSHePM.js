function Rr(j,An){return An.forEach(function(B){B&&typeof B!="string"&&!Array.isArray(B)&&Object.keys(B).forEach(function(W){if(W!=="default"&&!(W in j)){var p=Object.getOwnPropertyDescriptor(B,W);Object.defineProperty(j,W,p.get?p:{enumerable:!0,get:function(){return B[W]}})}})}),Object.freeze(j)}var Nr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mr(j){return j&&j.__esModule&&Object.prototype.hasOwnProperty.call(j,"default")?j.default:j}var ar={exports:{}},ur={exports:{}};(function(j,An){(function(B,W){j.exports=W()})(typeof self<"u"?self:Nr,function(){return function(B){var W={};function p(g){if(W[g])return W[g].exports;var E=W[g]={i:g,l:!1,exports:{}};return B[g].call(E.exports,E,E.exports,p),E.l=!0,E.exports}return p.m=B,p.c=W,p.d=function(g,E,J){p.o(g,E)||Object.defineProperty(g,E,{enumerable:!0,get:J})},p.r=function(g){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},p.t=function(g,E){if(1&E&&(g=p(g)),8&E||4&E&&typeof g=="object"&&g&&g.__esModule)return g;var J=Object.create(null);if(p.r(J),Object.defineProperty(J,"default",{enumerable:!0,value:g}),2&E&&typeof g!="string")for(var Q in g)p.d(J,Q,(function(un){return g[un]}).bind(null,Q));return J},p.n=function(g){var E=g&&g.__esModule?function(){return g.default}:function(){return g};return p.d(E,"a",E),E},p.o=function(g,E){return{}.hasOwnProperty.call(g,E)},p.p="",p(p.s=0)}([function(B,W,p){p.r(W),p.d(W,"Promise",function(){return x}),p.d(W,"TYPES",function(){return zr}),p.d(W,"ProxyWindow",function(){return T}),p.d(W,"setup",function(){return ir}),p.d(W,"destroy",function(){return Ir}),p.d(W,"serializeMessage",function(){return Pr}),p.d(W,"deserializeMessage",function(){return Or}),p.d(W,"createProxyWindow",function(){return Ar}),p.d(W,"toProxyWindow",function(){return Dr}),p.d(W,"on",function(){return U}),p.d(W,"once",function(){return br}),p.d(W,"send",function(){return Z}),p.d(W,"markWindowKnown",function(){return Kn}),p.d(W,"cleanUpWindow",function(){return jr}),p.d(W,"bridge",function(){});function g(n){return{}.toString.call(n)==="[object RegExp]"}var E=`Call was rejected by callee.\r
`;function J(n){return n===void 0&&(n=window),n.location.protocol}function Q(n){if(n===void 0&&(n=window),n.mockDomain){var t=n.mockDomain.split("//")[0];if(t)return t}return J(n)}function un(n){return n===void 0&&(n=window),Q(n)==="about:"}function G(n){if(n===void 0&&(n=window),n)try{if(n.parent&&n.parent!==n)return n.parent}catch{}}function Dn(n){if(n===void 0&&(n=window),n&&!G(n))try{return n.opener}catch{}}function cn(n){try{return!0}catch{}return!1}function sn(n){n===void 0&&(n=window);var t=n.location;if(!t)throw new Error("Can not read window location");var r=J(n);if(!r)throw new Error("Can not read window protocol");if(r==="file:")return"file://";if(r==="about:"){var e=G(n);return e&&cn()?sn(e):"about://"}var o=t.host;if(!o)throw new Error("Can not read window host");return r+"//"+o}function R(n){n===void 0&&(n=window);var t=sn(n);return t&&n.mockDomain&&n.mockDomain.indexOf("mock:")===0?n.mockDomain:t}function q(n){if(!function(t){try{if(t===window)return!0}catch{}try{var r=Object.getOwnPropertyDescriptor(t,"location");if(r&&r.enumerable===!1)return!1}catch{}try{if(un(t)&&cn())return!0}catch{}try{if(function(e){return e===void 0&&(e=window),Q(e)==="mock:"}(t)&&cn())return!0}catch{}try{if(sn(t)===sn(window))return!0}catch{}return!1}(n))return!1;try{if(n===window||un(n)&&cn()||R(window)===R(n))return!0}catch{}return!1}function fn(n){if(!q(n))throw new Error("Expected window to be same domain");return n}function In(n,t){if(!n||!t)return!1;var r=G(t);return r?r===n:function(e){var o=[];try{for(;e.parent!==e;)o.push(e.parent),e=e.parent}catch{}return o}(t).indexOf(n)!==-1}function zn(n){var t=[],r;try{r=n.frames}catch{r=n}var e;try{e=r.length}catch{}if(e===0)return t;if(e){for(var o=0;o<e;o++){var i=void 0;try{i=r[o]}catch{continue}t.push(i)}return t}for(var a=0;a<100;a++){var s=void 0;try{s=r[a]}catch{return t}if(!s)return t;t.push(s)}return t}var sr=[],fr=[];function L(n,t){t===void 0&&(t=!0);try{if(n===window)return!1}catch{return!0}try{if(!n)return!0}catch{return!0}try{if(n.closed)return!0}catch(o){return!o||o.message!==E}if(t&&q(n))try{if(n.mockclosed)return!0}catch{}try{if(!n.parent||!n.top)return!0}catch{}var r=function(o,i){for(var a=0;a<o.length;a++)try{if(o[a]===i)return a}catch{}return-1}(sr,n);if(r!==-1){var e=fr[r];if(e&&function(o){if(!o.contentWindow||!o.parentNode)return!0;var i=o.ownerDocument;if(i&&i.documentElement&&!i.documentElement.contains(o)){for(var a=o;a.parentNode&&a.parentNode!==a;)a=a.parentNode;if(!a.host||!i.documentElement.contains(a.host))return!0}return!1}(e))return!0}return!1}function jn(n){return n===void 0&&(n=window),Dn(n=n||window)||G(n)||void 0}function X(n,t){if(typeof n=="string"){if(typeof t=="string")return n==="*"||t===n;if(g(t)||Array.isArray(t))return!1}return g(n)?g(t)?n.toString()===t.toString():!Array.isArray(t)&&!!t.match(n):!!Array.isArray(n)&&(Array.isArray(t)?JSON.stringify(n)===JSON.stringify(t):!g(t)&&n.some(function(r){return X(r,t)}))}function dn(n){try{if(n===window)return!0}catch(t){if(t&&t.message===E)return!0}try{if({}.toString.call(n)==="[object Window]")return!0}catch(t){if(t&&t.message===E)return!0}try{if(window.Window&&n instanceof window.Window)return!0}catch(t){if(t&&t.message===E)return!0}try{if(n&&n.self===n)return!0}catch(t){if(t&&t.message===E)return!0}try{if(n&&n.parent===n)return!0}catch(t){if(t&&t.message===E)return!0}try{if(n&&n.top===n)return!0}catch(t){if(t&&t.message===E)return!0}try{if(n&&n.__cross_domain_utils_window_check__==="__unlikely_value__")return!1}catch{return!0}try{if("postMessage"in n&&"self"in n&&"location"in n)return!0}catch{}return!1}function Rn(n){if(q(n))return fn(n).frameElement;for(var t=0,r=document.querySelectorAll("iframe");t<r.length;t++){var e=r[t];if(e&&e.contentWindow&&e.contentWindow===n)return e}}function dr(n){if(function(r){return r===void 0&&(r=window),!!G(r)}(n)){var t=Rn(n);if(t&&t.parentElement){t.parentElement.removeChild(t);return}}try{n.close()}catch{}}function Y(n){try{if(!n)return!1;if(typeof Promise<"u"&&n instanceof Promise)return!0;if(typeof window<"u"&&typeof window.Window=="function"&&n instanceof window.Window||typeof window<"u"&&typeof window.constructor=="function"&&n instanceof window.constructor)return!1;var t={}.toString;if(t){var r=t.call(n);if(r==="[object Window]"||r==="[object global]"||r==="[object DOMWindow]")return!1}if(typeof n.then=="function")return!0}catch{return!1}return!1}var Nn=[],k=[],mn=0,$;function Mn(){if(!mn&&$){var n=$;$=null,n.resolve()}}function pn(){mn+=1}function _(){mn-=1,Mn()}var x=function(){function n(r){var e=this;if(this.resolved=void 0,this.rejected=void 0,this.errorHandled=void 0,this.value=void 0,this.error=void 0,this.handlers=void 0,this.dispatching=void 0,this.stack=void 0,this.resolved=!1,this.rejected=!1,this.errorHandled=!1,this.handlers=[],r){var o,i,a=!1,s=!1,c=!1;pn();try{r(function(u){c?e.resolve(u):(a=!0,o=u)},function(u){c?e.reject(u):(s=!0,i=u)})}catch(u){_(),this.reject(u);return}_(),c=!0,a?this.resolve(o):s&&this.reject(i)}}var t=n.prototype;return t.resolve=function(r){if(this.resolved||this.rejected)return this;if(Y(r))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=r,this.dispatch(),this},t.reject=function(r){var e=this;if(this.resolved||this.rejected)return this;if(Y(r))throw new Error("Can not reject promise with another promise");if(!r){var o=r&&typeof r.toString=="function"?r.toString():{}.toString.call(r);r=new Error("Expected reject to be called with Error, got "+o)}return this.rejected=!0,this.error=r,this.errorHandled||setTimeout(function(){e.errorHandled||function(i,a){if(Nn.indexOf(i)===-1){Nn.push(i),setTimeout(function(){throw i},1);for(var s=0;s<k.length;s++)k[s](i,a)}}(r,e)},1),this.dispatch(),this},t.asyncReject=function(r){return this.errorHandled=!0,this.reject(r),this},t.dispatch=function(){var r=this.resolved,e=this.rejected,o=this.handlers;if(!this.dispatching&&(r||e)){this.dispatching=!0,pn();for(var i=function(l,m){return l.then(function(v){m.resolve(v)},function(v){m.reject(v)})},a=0;a<o.length;a++){var s=o[a],c=s.onSuccess,u=s.onError,h=s.promise,f=void 0;if(r)try{f=c?c(this.value):this.value}catch(l){h.reject(l);continue}else if(e){if(!u){h.reject(this.error);continue}try{f=u(this.error)}catch(l){h.reject(l);continue}}if(f instanceof n&&(f.resolved||f.rejected)){var d=f;d.resolved?h.resolve(d.value):h.reject(d.error),d.errorHandled=!0}else Y(f)?f instanceof n&&(f.resolved||f.rejected)?f.resolved?h.resolve(f.value):h.reject(f.error):i(f,h):h.resolve(f)}o.length=0,this.dispatching=!1,_()}},t.then=function(r,e){if(r&&typeof r!="function"&&!r.call)throw new Error("Promise.then expected a function for success handler");if(e&&typeof e!="function"&&!e.call)throw new Error("Promise.then expected a function for error handler");var o=new n;return this.handlers.push({promise:o,onSuccess:r,onError:e}),this.errorHandled=!0,this.dispatch(),o},t.catch=function(r){return this.then(void 0,r)},t.finally=function(r){if(r&&typeof r!="function"&&!r.call)throw new Error("Promise.finally expected a function");return this.then(function(e){return n.try(r).then(function(){return e})},function(e){return n.try(r).then(function(){throw e})})},t.timeout=function(r,e){var o=this;if(this.resolved||this.rejected)return this;var i=setTimeout(function(){o.resolved||o.rejected||o.reject(e||new Error("Promise timed out after "+r+"ms"))},r);return this.then(function(a){return clearTimeout(i),a})},t.toPromise=function(){if(typeof Promise>"u")throw new TypeError("Could not find Promise");return Promise.resolve(this)},t.lazy=function(){return this.errorHandled=!0,this},n.resolve=function(r){return r instanceof n?r:Y(r)?new n(function(e,o){return r.then(e,o)}):new n().resolve(r)},n.reject=function(r){return new n().reject(r)},n.asyncReject=function(r){return new n().asyncReject(r)},n.all=function(r){var e=new n,o=r.length,i=[].slice();if(!o)return e.resolve(i),e;for(var a=function(u,h,f){return h.then(function(d){i[u]=d,(o-=1)==0&&e.resolve(i)},function(d){f.reject(d)})},s=0;s<r.length;s++){var c=r[s];if(c instanceof n){if(c.resolved){i[s]=c.value,o-=1;continue}}else if(!Y(c)){i[s]=c,o-=1;continue}a(s,n.resolve(c),e)}return o===0&&e.resolve(i),e},n.hash=function(r){var e={},o=[],i=function(s){if(r.hasOwnProperty(s)){var c=r[s];Y(c)?o.push(c.then(function(u){e[s]=u})):e[s]=c}};for(var a in r)i(a);return n.all(o).then(function(){return e})},n.map=function(r,e){return n.all(r.map(e))},n.onPossiblyUnhandledException=function(r){return function(e){return k.push(e),{cancel:function(){k.splice(k.indexOf(e),1)}}}(r)},n.try=function(r,e,o){if(r&&typeof r!="function"&&!r.call)throw new Error("Promise.try expected a function");var i;pn();try{i=r.apply(e,o||[])}catch(a){return _(),n.reject(a)}return _(),n.resolve(i)},n.delay=function(r){return new n(function(e){setTimeout(e,r)})},n.isPromise=function(r){return!!(r&&r instanceof n)||Y(r)},n.flush=function(){return function(r){var e=$=$||new r;return Mn(),e}(n)},n}();function hn(n,t){for(var r=0;r<n.length;r++)try{if(n[r]===t)return r}catch{}return-1}var gn=function(){function n(){if(this.name=void 0,this.weakmap=void 0,this.keys=void 0,this.values=void 0,this.name="__weakmap_"+(1e9*Math.random()>>>0)+"__",function(){if(typeof WeakMap>"u"||Object.freeze===void 0)return!1;try{var r=new WeakMap,e={};return Object.freeze(e),r.set(e,"__testvalue__"),r.get(e)==="__testvalue__"}catch{return!1}}())try{this.weakmap=new WeakMap}catch{}this.keys=[],this.values=[]}var t=n.prototype;return t._cleanupClosedWindows=function(){for(var r=this.weakmap,e=this.keys,o=0;o<e.length;o++){var i=e[o];if(dn(i)&&L(i)){if(r)try{r.delete(i)}catch{}e.splice(o,1),this.values.splice(o,1),o-=1}}},t.isSafeToReadWrite=function(r){return!dn(r)},t.set=function(r,e){if(!r)throw new Error("WeakMap expected key");var o=this.weakmap;if(o)try{o.set(r,e)}catch{delete this.weakmap}if(this.isSafeToReadWrite(r))try{var i=this.name,a=r[i];a&&a[0]===r?a[1]=e:Object.defineProperty(r,i,{value:[r,e],writable:!0});return}catch{}this._cleanupClosedWindows();var s=this.keys,c=this.values,u=hn(s,r);u===-1?(s.push(r),c.push(e)):c[u]=e},t.get=function(r){if(!r)throw new Error("WeakMap expected key");var e=this.weakmap;if(e)try{if(e.has(r))return e.get(r)}catch{delete this.weakmap}if(this.isSafeToReadWrite(r))try{var o=r[this.name];return o&&o[0]===r?o[1]:void 0}catch{}this._cleanupClosedWindows();var i=hn(this.keys,r);if(i!==-1)return this.values[i]},t.delete=function(r){if(!r)throw new Error("WeakMap expected key");var e=this.weakmap;if(e)try{e.delete(r)}catch{delete this.weakmap}if(this.isSafeToReadWrite(r))try{var o=r[this.name];o&&o[0]===r&&(o[0]=o[1]=void 0)}catch{}this._cleanupClosedWindows();var i=this.keys,a=hn(i,r);a!==-1&&(i.splice(a,1),this.values.splice(a,1))},t.has=function(r){if(!r)throw new Error("WeakMap expected key");var e=this.weakmap;if(e)try{if(e.has(r))return!0}catch{delete this.weakmap}if(this.isSafeToReadWrite(r))try{var o=r[this.name];return!(!o||o[0]!==r)}catch{}return this._cleanupClosedWindows(),hn(this.keys,r)!==-1},t.getOrSet=function(r,e){if(this.has(r))return this.get(r);var o=e();return this.set(r,o),o},n}();function Cn(n){return n.name||n.__name__||n.displayName||"anonymous"}function Tn(n,t){try{delete n.name,n.name=t}catch{}return n.__name__=n.displayName=t,n}function H(){var n="0123456789abcdef";return"uid_"+"xxxxxxxxxx".replace(/./g,function(){return n.charAt(Math.floor(Math.random()*n.length))})+"_"+function(t){if(typeof btoa=="function")return btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(r,e){return String.fromCharCode(parseInt(e,16))})).replace(/[=]/g,"");if(typeof Buffer<"u")return Buffer.from(t,"utf8").toString("base64").replace(/[=]/g,"");throw new Error("Can not find window.btoa or Buffer")}(new Date().toISOString().slice(11,19).replace("T",".")).replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}var ln;function Ln(n){try{return JSON.stringify([].slice.call(n),function(t,r){return typeof r=="function"?"memoize["+function(e){if(ln=ln||new gn,e==null||typeof e!="object"&&typeof e!="function")throw new Error("Invalid object");var o=ln.get(e);return o||(o=typeof e+":"+H(),ln.set(e,o)),o}(r)+"]":typeof window<"u"&&r instanceof window.Element||r!==null&&typeof r=="object"&&r.nodeType===1&&typeof r.style=="object"&&typeof r.ownerDocument=="object"?{}:r})}catch{throw new Error("Arguments not serializable -- can not be used to memoize")}}function hr(){return{}}var nn=0,Fn=0;function rn(n,t){t===void 0&&(t={});var r=t.thisNamespace,e=r!==void 0&&r,o=t.time,i,a,s=nn;nn+=1;var c=function(){for(var u=arguments.length,h=new Array(u),f=0;f<u;f++)h[f]=arguments[f];s<Fn&&(i=null,a=null,s=nn,nn+=1);var d;d=e?(a=a||new gn).getOrSet(this,hr):i=i||{};var l;try{l=Ln(h)}catch{return n.apply(this,arguments)}var m=d[l];if(m&&o&&Date.now()-m.time<o&&(delete d[l],m=null),m)return m.value;var v=Date.now(),w=n.apply(this,arguments);return d[l]={time:v,value:w},w};return c.reset=function(){i=null,a=null},Tn(c,(t.name||Cn(n))+"::memoized")}rn.clear=function(){Fn=nn};function lr(n){var t={};function r(){for(var e=arguments,o=this,i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];var c=Ln(a);return t.hasOwnProperty(c)||(t[c]=x.try(function(){return n.apply(o,e)}).finally(function(){delete t[c]})),t[c]}return r.reset=function(){t={}},Tn(r,Cn(n)+"::promiseMemoized")}function K(){}function tn(n,t){if(t===void 0&&(t=1),t>=3)return"stringifyError stack overflow";try{if(!n)return"<unknown error: "+{}.toString.call(n)+">";if(typeof n=="string")return n;if(n instanceof Error){var r=n&&n.stack,e=n&&n.message;if(r&&e)return r.indexOf(e)!==-1?r:e+`
`+r;if(r)return r;if(e)return e}return n&&n.toString&&typeof n.toString=="function"?n.toString():{}.toString.call(n)}catch(o){return"Error while stringifying error: "+tn(o,t+1)}}function Bn(n){return typeof n=="string"?n:n&&n.toString&&typeof n.toString=="function"?n.toString():{}.toString.call(n)}rn(function(n){if(Object.values)return Object.values(n);var t=[];for(var r in n)n.hasOwnProperty(r)&&t.push(n[r]);return t});function yn(n){return{}.toString.call(n)==="[object RegExp]"}function en(n,t,r){if(n.hasOwnProperty(t))return n[t];var e=r();return n[t]=e,e}function Hn(){var n=document.body;if(!n)throw new Error("Body element not found");return n}function Jn(){return!!document.body&&document.readyState==="complete"}function Un(){return!!document.body&&document.readyState==="interactive"}rn(function(){return new x(function(n){if(Jn()||Un())return n();var t=setInterval(function(){if(Jn()||Un())return clearInterval(t),n()},10)})});var vn=typeof document<"u"?document.currentScript:null,vr=rn(function(){if(vn||(vn=function(){try{var n=function(){try{throw new Error("_")}catch(a){return a.stack||""}}(),t=/.*at [^(]*\((.*):(.+):(.+)\)$/gi.exec(n),r=t&&t[1];if(!r)return;for(var e=0,o=[].slice.call(document.getElementsByTagName("script")).reverse();e<o.length;e++){var i=o[e];if(i.src&&i.src===r)return i}}catch{}}()))return vn;throw new Error("Can not determine current script")}),wr=H();rn(function(){var n;try{n=vr()}catch{return wr}var t=n.getAttribute("data-uid");if(t&&typeof t=="string"||(t=n.getAttribute("data-uid-auto"))&&typeof t=="string")return t;if(n.src){var r=function(e){for(var o="",i=0;i<e.length;i++){var a=e[i].charCodeAt(0)*i;e[i+1]&&(a+=e[i+1].charCodeAt(0)*(i-1)),o+=String.fromCharCode(97+Math.abs(a)%26)}return o}(JSON.stringify({src:n.src,dataset:n.dataset}));t="uid_"+r.slice(r.length-30)}else t=H();return n.setAttribute("data-uid-auto",t),t});function on(n){n===void 0&&(n=window);var t="__post_robot_10_0_46__";return n!==window?n[t]:n[t]=n[t]||{}}var Zn=function(){return{}};function I(n,t){return n===void 0&&(n="store"),t===void 0&&(t=Zn),en(on(),n,function(){var r=t();return{has:function(e){return r.hasOwnProperty(e)},get:function(e,o){return r.hasOwnProperty(e)?r[e]:o},set:function(e,o){return r[e]=o,o},del:function(e){delete r[e]},getOrSet:function(e,o){return en(r,e,o)},reset:function(){r=t()},keys:function(){return Object.keys(r)}}})}var mr=function(){};function wn(){var n=on();return n.WINDOW_WILDCARD=n.WINDOW_WILDCARD||new mr,n.WINDOW_WILDCARD}function N(n,t){return n===void 0&&(n="store"),t===void 0&&(t=Zn),I("windowStore").getOrSet(n,function(){var r=new gn,e=function(o){return r.getOrSet(o,t)};return{has:function(o){return e(o).hasOwnProperty(n)},get:function(o,i){var a=e(o);return a.hasOwnProperty(n)?a[n]:i},set:function(o,i){return e(o)[n]=i,i},del:function(o){delete e(o)[n]},getOrSet:function(o,i){return en(e(o),n,i)}}})}function Gn(){return I("instance").getOrSet("instanceID",H)}function qn(n,t){var r=t.domain,e=N("helloPromises"),o=e.get(n);o&&o.resolve({domain:r});var i=x.resolve({domain:r});return e.set(n,i),i}function Wn(n,t){return(0,t.send)(n,"postrobot_hello",{instanceID:Gn()},{domain:"*",timeout:-1}).then(function(r){var e=r.origin,o=r.data.instanceID;return qn(n,{domain:e}),{win:n,domain:e,instanceID:o}})}function Yn(n,t){var r=t.send;return N("windowInstanceIDPromises").getOrSet(n,function(){return Wn(n,{send:r}).then(function(e){return e.instanceID})})}function Kn(n){N("knownWindows").set(n,!0)}function En(n){return typeof n=="object"&&n!==null&&typeof n.__type__=="string"}function Vn(n){return n===void 0?"undefined":n===null?"null":Array.isArray(n)?"array":typeof n=="function"?"function":typeof n=="object"?n instanceof Error?"error":typeof n.then=="function"?"promise":{}.toString.call(n)==="[object RegExp]"?"regex":{}.toString.call(n)==="[object Date]"?"date":"object":typeof n=="string"?"string":typeof n=="number"?"number":typeof n=="boolean"?"boolean":void 0}function V(n,t){return{__type__:n,__val__:t}}var M,pr=((M={}).function=function(){},M.error=function(n){return V("error",{message:n.message,stack:n.stack,code:n.code,data:n.data})},M.promise=function(){},M.regex=function(n){return V("regex",n.source)},M.date=function(n){return V("date",n.toJSON())},M.array=function(n){return n},M.object=function(n){return n},M.string=function(n){return n},M.number=function(n){return n},M.boolean=function(n){return n},M.null=function(n){return n},M[void 0]=function(n){return V("undefined",n)},M),gr={},C,yr=((C={}).function=function(){throw new Error("Function serialization is not implemented; nothing to deserialize")},C.error=function(n){var t=n.stack,r=n.code,e=n.data,o=new Error(n.message);return o.code=r,e&&(o.data=e),o.stack=t+`

`+o.stack,o},C.promise=function(){throw new Error("Promise serialization is not implemented; nothing to deserialize")},C.regex=function(n){return new RegExp(n)},C.date=function(n){return new Date(n)},C.array=function(n){return n},C.object=function(n){return n},C.string=function(n){return n},C.number=function(n){return n},C.boolean=function(n){return n},C.null=function(n){return n},C[void 0]=function(){},C),Wr={};new x(function(n){if(window.document&&window.document.body)return n(window.document.body);var t=setInterval(function(){if(window.document&&window.document.body)return clearInterval(t),n(window.document.body)},10)});function xn(){for(var n=I("idToProxyWindow"),t=0,r=n.keys();t<r.length;t++){var e=r[t];n.get(e).shouldClean()&&n.del(e)}}function Xn(n,t){var r=t.send,e=t.id,o=e===void 0?H():e,i=n.then(function(c){if(q(c))return fn(c).name}),a=n.then(function(c){if(L(c))throw new Error("Window is closed, can not determine type");return Dn(c)?"popup":"iframe"});i.catch(K),a.catch(K);var s=function(){return n.then(function(c){if(!L(c))return q(c)?fn(c).name:i})};return{id:o,getType:function(){return a},getInstanceID:lr(function(){return n.then(function(c){return Yn(c,{send:r})})}),close:function(){return n.then(dr)},getName:s,focus:function(){return n.then(function(c){c.focus()})},isClosed:function(){return n.then(function(c){return L(c)})},setLocation:function(c,u){return u===void 0&&(u={}),n.then(function(h){var f=window.location.protocol+"//"+window.location.host,d=u.method,l=d===void 0?"get":d,m=u.body;if(c.indexOf("/")===0)c=""+f+c;else if(!c.match(/^https?:\/\//)&&c.indexOf(f)!==0)throw new Error("Expected url to be http or https url, or absolute path, got "+JSON.stringify(c));if(l==="post")return s().then(function(v){if(!v)throw new Error("Can not post to window without target name");(function(w){var S=w.url,D=w.target,P=w.body,b=w.method,z=b===void 0?"post":b,y=document.createElement("form");if(y.setAttribute("target",D),y.setAttribute("method",z),y.setAttribute("action",S),y.style.display="none",P)for(var O=0,F=Object.keys(P);O<F.length;O++){var A,an=F[O],On=document.createElement("input");On.setAttribute("name",an),On.setAttribute("value",(A=P[an])==null?void 0:A.toString()),y.appendChild(On)}Hn().appendChild(y),y.submit(),Hn().removeChild(y)})({url:c,target:v,method:l,body:m})});if(l!=="get")throw new Error("Unsupported method: "+l);if(q(h))try{if(h.location&&typeof h.location.replace=="function"){h.location.replace(c);return}}catch{}h.location=c})},setName:function(c){return n.then(function(u){var h=q(u),f=Rn(u);if(!h)throw new Error("Can not set name for cross-domain window: "+c);fn(u).name=c,f&&f.setAttribute("name",c),i=x.resolve(c)})}}}var T=function(){function n(r){var e=r.send,o=r.win,i=r.serializedWindow;this.id=void 0,this.isProxyWindow=!0,this.serializedWindow=void 0,this.actualWindow=void 0,this.actualWindowPromise=void 0,this.send=void 0,this.name=void 0,this.actualWindowPromise=new x,this.serializedWindow=i||Xn(this.actualWindowPromise,{send:e}),I("idToProxyWindow").set(this.getID(),this),o&&this.setWindow(o,{send:e})}var t=n.prototype;return t.getID=function(){return this.serializedWindow.id},t.getType=function(){return this.serializedWindow.getType()},t.isPopup=function(){return this.getType().then(function(r){return r==="popup"})},t.setLocation=function(r,e){var o=this;return this.serializedWindow.setLocation(r,e).then(function(){return o})},t.getName=function(){return this.serializedWindow.getName()},t.setName=function(r){var e=this;return this.serializedWindow.setName(r).then(function(){return e})},t.close=function(){var r=this;return this.serializedWindow.close().then(function(){return r})},t.focus=function(){var r=this,e=this.isPopup(),o=this.getName(),i=x.hash({isPopup:e,name:o}).then(function(s){var c=s.name;s.isPopup&&c&&window.open("",c,"noopener")}),a=this.serializedWindow.focus();return x.all([i,a]).then(function(){return r})},t.isClosed=function(){return this.serializedWindow.isClosed()},t.getWindow=function(){return this.actualWindow},t.setWindow=function(r,e){var o=e.send;this.actualWindow=r,this.actualWindowPromise.resolve(this.actualWindow),this.serializedWindow=Xn(this.actualWindowPromise,{send:o,id:this.getID()}),N("winToProxyWindow").set(r,this)},t.awaitWindow=function(){return this.actualWindowPromise},t.matchWindow=function(r,e){var o=this,i=e.send;return x.try(function(){return o.actualWindow?r===o.actualWindow:x.hash({proxyInstanceID:o.getInstanceID(),knownWindowInstanceID:Yn(r,{send:i})}).then(function(a){var s=a.proxyInstanceID===a.knownWindowInstanceID;return s&&o.setWindow(r,{send:i}),s})})},t.unwrap=function(){return this.actualWindow||this},t.getInstanceID=function(){return this.serializedWindow.getInstanceID()},t.shouldClean=function(){return!!(this.actualWindow&&L(this.actualWindow))},t.serialize=function(){return this.serializedWindow},n.unwrap=function(r){return n.isProxyWindow(r)?r.unwrap():r},n.serialize=function(r,e){var o=e.send;return xn(),n.toProxyWindow(r,{send:o}).serialize()},n.deserialize=function(r,e){var o=e.send;return xn(),I("idToProxyWindow").get(r.id)||new n({serializedWindow:r,send:o})},n.isProxyWindow=function(r){return!!(r&&!dn(r)&&r.isProxyWindow)},n.toProxyWindow=function(r,e){var o=e.send;if(xn(),n.isProxyWindow(r))return r;var i=r;return N("winToProxyWindow").get(i)||new n({win:i,send:o})},n}();function Sn(n,t,r,e,o){var i=N("methodStore"),a=I("proxyWindowMethods");T.isProxyWindow(e)?a.set(n,{val:t,name:r,domain:o,source:e}):(a.del(n),i.getOrSet(e,function(){return{}})[n]={domain:o,name:r,val:t,source:e})}function Qn(n,t){var r=N("methodStore"),e=I("proxyWindowMethods");return r.getOrSet(n,function(){return{}})[t]||e.get(t)}function kn(n,t,r,e,o){a=(i={on:o.on,send:o.send}).on,s=i.send,I("builtinListeners").getOrSet("functionCalls",function(){return a("postrobot_method",{domain:"*"},function(h){var f=h.source,d=h.origin,l=h.data,m=l.id,v=l.name,w=Qn(f,m);if(!w)throw new Error("Could not find method '"+v+"' with id: "+l.id+" in "+R(window));var S=w.source,D=w.domain,P=w.val;return x.try(function(){if(!X(D,d))throw new Error("Method '"+l.name+"' domain "+JSON.stringify(yn(w.domain)?w.domain.source:w.domain)+" does not match origin "+d+" in "+R(window));if(T.isProxyWindow(S))return S.matchWindow(f,{send:s}).then(function(b){if(!b)throw new Error("Method call '"+l.name+"' failed - proxy window does not match source in "+R(window))})}).then(function(){return P.apply({source:f,origin:d},l.args)},function(b){return x.try(function(){if(P.onError)return P.onError(b)}).then(function(){throw b.stack&&(b.stack="Remote call to "+v+"("+function(z){return z===void 0&&(z=[]),(y=z,[].slice.call(y)).map(function(O){return typeof O=="string"?"'"+O+"'":O===void 0?"undefined":O===null?"null":typeof O=="boolean"?O.toString():Array.isArray(O)?"[ ... ]":typeof O=="object"?"{ ... }":typeof O=="function"?"() => { ... }":"<"+typeof O+">"}).join(", ");var y}(l.args)+`) failed

`+b.stack),b})}).then(function(b){return{result:b,id:m,name:v}})})});var i,a,s,c=r.__id__||H();n=T.unwrap(n);var u=r.__name__||r.name||e;return typeof u=="string"&&typeof u.indexOf=="function"&&u.indexOf("anonymous::")===0&&(u=u.replace("anonymous::",e+"::")),T.isProxyWindow(n)?(Sn(c,r,u,n,t),n.awaitWindow().then(function(h){Sn(c,r,u,h,t)})):Sn(c,r,u,n,t),V("cross_domain_function",{id:c,name:u})}function $n(n,t,r,e){var o,i=e.on,a=e.send;return function(s,c){c===void 0&&(c=gr);var u=JSON.stringify(s,function(h){var f=this[h];if(En(this))return f;var d=Vn(f);if(!d)return f;var l=c[d]||pr[d];return l?l(f,h):f});return u===void 0?"undefined":u}(r,((o={}).promise=function(s,c){return function(u,h,f,d,l){return V("cross_domain_zalgo_promise",{then:kn(u,h,function(m,v){return f.then(m,v)},d,{on:l.on,send:l.send})})}(n,t,s,c,{on:i,send:a})},o.function=function(s,c){return kn(n,t,s,c,{on:i,send:a})},o.object=function(s){return dn(s)||T.isProxyWindow(s)?V("cross_domain_window",T.serialize(s,{send:a})):s},o))}function _n(n,t,r,e){var o,i=e.send;return function(a,s){if(s===void 0&&(s=Wr),a!=="undefined")return JSON.parse(a,function(c,u){if(En(this))return u;var h,f;if(En(u)?(h=u.__type__,f=u.__val__):(h=Vn(u),f=u),!h)return f;var d=s[h]||yr[h];return d?d(f,c):f})}(r,((o={}).cross_domain_zalgo_promise=function(a){return function(s,c,u){return new x(u.then)}(0,0,a)},o.cross_domain_function=function(a){return function(s,c,u,h){var f=u.id,d=u.name,l=h.send,m=function(w){w===void 0&&(w={});function S(){var D=arguments;return T.toProxyWindow(s,{send:l}).awaitWindow().then(function(P){var b=Qn(P,f);if(b&&b.val!==S)return b.val.apply({source:window,origin:R()},D);var z=[].slice.call(D);return w.fireAndForget?l(P,"postrobot_method",{id:f,name:d,args:z},{domain:c,fireAndForget:!0}):l(P,"postrobot_method",{id:f,name:d,args:z},{domain:c,fireAndForget:!1}).then(function(y){return y.data.result})}).catch(function(P){throw P})}return S.__name__=d,S.__origin__=c,S.__source__=s,S.__id__=f,S.origin=c,S},v=m();return v.fireAndForget=m({fireAndForget:!0}),v}(n,t,a,{send:i})},o.cross_domain_window=function(a){return T.deserialize(a,{send:i})},o))}var bn={};bn.postrobot_post_message=function(n,t,r){r.indexOf("file:")===0&&(r="*"),n.postMessage(t,r)};function Pn(n,t,r,e){var o=e.on,i=e.send;return x.try(function(){var a=N().getOrSet(n,function(){return{}});return a.buffer=a.buffer||[],a.buffer.push(r),a.flush=a.flush||x.flush().then(function(){if(L(n))throw new Error("Window is closed");var s=$n(n,t,((c={}).__post_robot_10_0_46__=a.buffer||[],c),{on:o,send:i}),c;delete a.buffer;for(var u=Object.keys(bn),h=[],f=0;f<u.length;f++){var d=u[f];try{bn[d](n,s,t)}catch(l){h.push(l)}}if(h.length===u.length)throw new Error(`All post-robot messaging strategies failed:

`+h.map(function(l,m){return m+". "+tn(l)}).join(`

`))}),a.flush.then(function(){delete a.flush})}).then(K)}function nr(n){return I("responseListeners").get(n)}function rr(n){I("responseListeners").del(n)}function tr(n){return I("erroredResponseListeners").has(n)}function er(n){var t=n.name,r=n.win,e=n.domain,o=N("requestListeners");if(r==="*"&&(r=null),e==="*"&&(e=null),!t)throw new Error("Name required to get request listener");for(var i=0,a=[r,wn()];i<a.length;i++){var s=a[i];if(s){var c=o.get(s);if(c){var u=c[t];if(u){if(e&&typeof e=="string"){if(u[e])return u[e];if(u.__domain_regex__)for(var h=0,f=u.__domain_regex__;h<f.length;h++){var d=f[h],l=d.listener;if(X(d.regex,e))return l}}if(u["*"])return u["*"]}}}}}function Er(n,t,r,e){var o=e.on,i=e.send,a=er({name:r.name,win:n,domain:t}),s=r.name==="postrobot_method"&&r.data&&typeof r.data.name=="string"?r.data.name+"()":r.name;function c(u,h,f){return x.flush().then(function(){if(!r.fireAndForget&&!L(n))try{return Pn(n,t,{id:H(),origin:R(window),type:"postrobot_message_response",hash:r.hash,name:r.name,ack:u,data:h,error:f},{on:o,send:i})}catch(d){throw new Error("Send response message failed for "+s+" in "+R()+`

`+tn(d))}})}return x.all([x.flush().then(function(){if(!r.fireAndForget&&!L(n))try{return Pn(n,t,{id:H(),origin:R(window),type:"postrobot_message_ack",hash:r.hash,name:r.name},{on:o,send:i})}catch(u){throw new Error("Send ack message failed for "+s+" in "+R()+`

`+tn(u))}}),x.try(function(){if(!a)throw new Error("No handler found for post message: "+r.name+" from "+t+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);return a.handler({source:n,origin:t,data:r.data})}).then(function(u){return c("success",u)},function(u){return c("error",null,u)})]).then(K).catch(function(u){if(a&&a.handleError)return a.handleError(u);throw u})}function xr(n,t,r){if(!tr(r.hash)){var e=nr(r.hash);if(!e)throw new Error("No handler found for post message ack for message: "+r.name+" from "+t+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);try{if(!X(e.domain,t))throw new Error("Ack origin "+t+" does not match domain "+e.domain.toString());if(n!==e.win)throw new Error("Ack source does not match registered window")}catch(o){e.promise.reject(o)}e.ack=!0}}function Sr(n,t,r){if(!tr(r.hash)){var e=nr(r.hash);if(!e)throw new Error("No handler found for post message response for message: "+r.name+" from "+t+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!X(e.domain,t))throw new Error("Response origin "+t+" does not match domain "+(o=e.domain,Array.isArray(o)?"("+o.join(" | ")+")":g(o)?"RegExp("+o.toString()+")":o.toString()));var o;if(n!==e.win)throw new Error("Response source does not match registered window");rr(r.hash),r.ack==="error"?e.promise.reject(r.error):r.ack==="success"&&e.promise.resolve({source:n,origin:t,data:r.data})}}function or(n,t){var r=t.on,e=t.send,o=I("receivedMessages");try{if(!window||window.closed||!n.source)return}catch{return}var i=n.source,a=n.origin,s=function(h,f,d,l){var m=l.on,v=l.send,w;try{w=_n(f,d,h,{on:m,send:v})}catch{return}if(w&&typeof w=="object"&&w!==null){var S=w.__post_robot_10_0_46__;if(Array.isArray(S))return S}}(n.data,i,a,{on:r,send:e});if(s){Kn(i);for(var c=0;c<s.length;c++){var u=s[c];if(o.has(u.id)||(o.set(u.id,!0),L(i)&&!u.fireAndForget))return;u.origin.indexOf("file:")===0&&(a="file://");try{u.type==="postrobot_message_request"?Er(i,a,u,{on:r,send:e}):u.type==="postrobot_message_response"?Sr(i,a,u):u.type==="postrobot_message_ack"&&xr(i,a,u)}catch(h){setTimeout(function(){throw h},0)}}}}function U(n,t,r){if(!n)throw new Error("Expected name");if(typeof(t=t||{})=="function"&&(r=t,t={}),!r)throw new Error("Expected handler");var e=function o(i,a){var s=i.name,c=i.win,u=i.domain,h=N("requestListeners");if(!s||typeof s!="string")throw new Error("Name required to add request listener");if(c&&c!=="*"&&T.isProxyWindow(c)){var f=c.awaitWindow().then(function(A){return o({name:s,win:A,domain:u},a)});return{cancel:function(){f.then(function(A){return A.cancel()},K)}}}var d=c;if(Array.isArray(d)){for(var l=[],m=0,v=d;m<v.length;m++)l.push(o({name:s,domain:u,win:v[m]},a));return{cancel:function(){for(var A=0;A<l.length;A++)l[A].cancel()}}}if(Array.isArray(u)){for(var w=[],S=0,D=u;S<D.length;S++)w.push(o({name:s,win:d,domain:D[S]},a));return{cancel:function(){for(var A=0;A<w.length;A++)w[A].cancel()}}}var P=er({name:s,win:d,domain:u});d&&d!=="*"||(d=wn());var b=(u=u||"*").toString();if(P)throw d&&u?new Error("Request listener already exists for "+s+" on domain "+u.toString()+" for "+(d===wn()?"wildcard":"specified")+" window"):d?new Error("Request listener already exists for "+s+" for "+(d===wn()?"wildcard":"specified")+" window"):u?new Error("Request listener already exists for "+s+" on domain "+u.toString()):new Error("Request listener already exists for "+s);var z=h.getOrSet(d,function(){return{}}),y=en(z,s,function(){return{}}),O,F;return yn(u)?(O=en(y,"__domain_regex__",function(){return[]})).push(F={regex:u,listener:a}):y[b]=a,{cancel:function(){delete y[b],F&&(O.splice(O.indexOf(F,1)),O.length||delete y.__domain_regex__),Object.keys(y).length||delete z[s],d&&!Object.keys(z).length&&h.del(d)}}}({name:n,win:t.window,domain:t.domain||"*"},{handler:r||t.handler,handleError:t.errorHandler||function(o){throw o}});return{cancel:function(){e.cancel()}}}function br(n,t,r){typeof(t=t||{})=="function"&&(r=t,t={});var e=new x,o;return t.errorHandler=function(i){o.cancel(),e.reject(i)},o=U(n,t,function(i){if(o.cancel(),e.resolve(i),r)return r(i)}),e.cancel=o.cancel,e}var Z=function n(t,r,e,o){var i=(o=o||{}).domain||"*",a=o.timeout||-1,s=o.timeout||5e3,c=o.fireAndForget||!1;return T.toProxyWindow(t,{send:n}).awaitWindow().then(function(u){return x.try(function(){if(function(h,f,d){if(!h)throw new Error("Expected name");if(d&&typeof d!="string"&&!Array.isArray(d)&&!yn(d))throw new TypeError("Can not send "+h+". Expected domain "+JSON.stringify(d)+" to be a string, array, or regex");if(L(f))throw new Error("Can not send "+h+". Target window is closed")}(r,u,i),function(h,f){var d=jn(f);if(d)return d===h;if(f===h||function(v){v===void 0&&(v=window);try{if(v.top)return v.top}catch{}if(G(v)===v)return v;try{if(In(window,v)&&window.top)return window.top}catch{}try{if(In(v,window)&&window.top)return window.top}catch{}for(var w=0,S=function P(b){for(var z=[],y=0,O=zn(b);y<O.length;y++){var F=O[y];z.push(F);for(var A=0,an=P(F);A<an.length;A++)z.push(an[A])}return z}(v);w<S.length;w++){var D=S[w];try{if(D.top)return D.top}catch{}if(G(D)===D)return D}}(f)===f)return!1;for(var l=0,m=zn(h);l<m.length;l++)if(m[l]===f)return!0;return!1}(window,u))return function(h,f,d){f===void 0&&(f=5e3),d===void 0&&(d="Window");var l=function(m){return N("helloPromises").getOrSet(m,function(){return new x})}(h);return f!==-1&&(l=l.timeout(f,new Error(d+" did not load after "+f+"ms"))),l}(u,s)}).then(function(h){return function(f,d,l,m){var v=m.send;return x.try(function(){return typeof d=="string"?d:x.try(function(){return l||Wn(f,{send:v}).then(function(w){return w.domain})}).then(function(w){if(!X(d,d))throw new Error("Domain "+Bn(d)+" does not match "+Bn(d));return w})})}(u,i,(h===void 0?{}:h).domain,{send:n})}).then(function(h){var f=h,d=r==="postrobot_method"&&e&&typeof e.name=="string"?e.name+"()":r,l=new x,m=r+"_"+H();if(!c){var v={name:r,win:u,domain:f,promise:l};(function(y,O){I("responseListeners").set(y,O)})(m,v);var w=N("requestPromises").getOrSet(u,function(){return[]});w.push(l),l.catch(function(){(function(y){I("erroredResponseListeners").set(y,!0)})(m),rr(m)});var S=function(y){return N("knownWindows").get(y,!1)}(u)?1e4:2e3,D=a,P=S,b=D,z=function(y,O){var F;return function A(){F=setTimeout(function(){(function(){if(L(u))return l.reject(new Error("Window closed for "+r+" before "+(v.ack?"response":"ack")));if(v.cancelled)return l.reject(new Error("Response listener was cancelled for "+r));P=Math.max(P-500,0),b!==-1&&(b=Math.max(b-500,0)),v.ack||P!==0?b===0&&l.reject(new Error("No response for postMessage "+d+" in "+R()+" in "+D+"ms")):l.reject(new Error("No ack for postMessage "+d+" in "+R()+" in "+S+"ms"))})(),A()},500)}(),{cancel:function(){clearTimeout(F)}}}();l.finally(function(){z.cancel(),w.splice(w.indexOf(l,1))}).catch(K)}return Pn(u,f,{id:H(),origin:R(window),type:"postrobot_message_request",hash:m,name:r,data:e,fireAndForget:c},{on:U,send:n}).then(function(){return c?l.resolve():l},function(y){throw new Error("Send request message failed for "+d+" in "+R()+`

`+tn(y))})})})};function Pr(n,t,r){return $n(n,t,r,{on:U,send:Z})}function Or(n,t,r){return _n(n,t,r,{on:U,send:Z})}function Ar(n){return new T({send:Z,win:n})}function Dr(n){return T.toProxyWindow(n,{send:Z})}function ir(){on().initialized||(on().initialized=!0,t=(n={on:U,send:Z}).on,r=n.send,(e=on()).receiveMessage=e.receiveMessage||function(o){return or(o,{on:t,send:r})},function(o){var i=o.on,a=o.send;I().getOrSet("postMessageListener",function(){return function(s,c,u){return s.addEventListener("message",u),{cancel:function(){s.removeEventListener("message",u)}}}(window,0,function(s){(function(c,u){var h=u.on,f=u.send;x.try(function(){var d=c.source||c.sourceElement,l=c.origin||c.originalEvent&&c.originalEvent.origin,m=c.data;if(l==="null"&&(l="file://"),d){if(!l)throw new Error("Post message did not have origin domain");or({source:d,origin:l,data:m},{on:h,send:f})}})})(s,{on:i,send:a})})})}({on:U,send:Z}),function(o){var i=o.on,a=o.send;I("builtinListeners").getOrSet("helloListener",function(){var s=i("postrobot_hello",{domain:"*"},function(u){return qn(u.source,{domain:u.origin}),{instanceID:Gn()}}),c=jn();return c&&Wn(c,{send:a}).catch(function(u){}),s})}({on:U,send:Z}));var n,t,r,e}function Ir(){(function(){for(var t=I("responseListeners"),r=0,e=t.keys();r<e.length;r++){var o=e[r],i=t.get(o);i&&(i.cancelled=!0),t.del(o)}})(),(n=I().get("postMessageListener"))&&n.cancel();var n;delete window.__post_robot_10_0_46__}var zr=!0;function jr(n){for(var t=0,r=N("requestPromises").get(n,[]);t<r.length;t++)r[t].reject(new Error("Window "+(L(n)?"closed":"cleaned up")+" before response")).catch(K)}ir()}])})})(ur);var Cr=ur.exports;(function(j){j.exports=Cr,j.exports.default=j.exports})(ar);var cr=ar.exports,Tr=Mr(cr),Lr=Rr({__proto__:null,default:Tr},[cr]);export{Lr as i};
